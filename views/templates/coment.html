<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Comment</title>
  <!-- plugins:css -->
  <link rel="stylesheet" href="{{.base_url}}assets/vendors/mdi/css/materialdesignicons.min.css">
  <link rel="stylesheet" href="{{.base_url}}assets/vendors/base/vendor.bundle.base.css">
  <!-- endinject -->
  <!-- inject:css -->
  <link rel="stylesheet" href="{{.base_url}}assets/css/style.css">
  <!-- endinject -->
  <link rel="shortcut icon" href="{{.base_url}}assets/images/favicon.png" />
  <link rel="stylesheet" href="https://cdn.datatables.net/1.12.1/css/jquery.dataTables.min.css">
  <!-- <link rel="stylesheet" href="{{.base_url}}assets/css/fontawesome-free/css/fontawesome.min.css"> -->
  <link href="https://use.fontawesome.com/releases/v5.0.6/css/all.css" rel="stylesheet">
</head>
<style>
  .preview-png{
      width: 187px;
      height: 162px;
      /* background-color: rgb(209, 209, 209); */
      object-fit: contain;
      border: 1px #e1e5eb solid;
      border-radius: 5px;
  }
</style>

<body>
  <div class="container-scroller">
    <!-- partial:{{.base_url}}assets/partials/_navbar.html -->
    <nav class="navbar col-lg-12 col-12 p-0 fixed-top d-flex flex-row">
      <div class="navbar-brand-wrapper d-flex justify-content-center">
        <div class="navbar-brand-inner-wrapper d-flex justify-content-between align-items-center w-100">  
          <a class="navbar-brand brand-logo" href="{{.base_url}}assets/index.html"><img src="{{.base_url}}assets/images/logo.svg" alt="logo"/></a>
          <a class="navbar-brand brand-logo-mini" href="{{.base_url}}assets/index.html"><img src="{{.base_url}}assets/images/logo-mini.svg" alt="logo"/></a>
          <button class="navbar-toggler navbar-toggler align-self-center" type="button" data-toggle="minimize">
            <span class="mdi mdi-sort-variant"></span>
          </button>
        </div>  
      </div>
      <div class="navbar-menu-wrapper d-flex align-items-center justify-content-end">
        <ul class="navbar-nav navbar-nav-right">
          <li class="nav-item nav-profile dropdown">
            <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown" id="profileDropdown">
              <span class="nav-profile-name">Options</span>
            </a>
            <div class="dropdown-menu dropdown-menu-right navbar-dropdown" aria-labelledby="profileDropdown">
                <a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#staticBackdrop3">
                    <i class="mdi mdi-settings text-primary"></i>
                    Update Profile
                  </a>
              <a class="dropdown-item" onclick="logout()">
                <i class="mdi mdi-logout text-primary"></i>
                Logout
              </a>
            </div>
          </li>
        </ul>
        <button class="navbar-toggler navbar-toggler-right d-lg-none align-self-center" type="button" data-toggle="offcanvas">
          <span class="mdi mdi-menu"></span>
        </button>
      </div>
    </nav>
    <!-- partial -->
    <div class="container-fluid page-body-wrapper">
      <!-- partial:{{.base_url}}assets/partials/_sidebar.html -->
      <nav class="sidebar sidebar-offcanvas" id="sidebar">
        <ul class="nav">
          <!-- <li class="nav-item">
            <a class="nav-link" href="{{.base_url}}assets/index.html">
              <i class="mdi mdi-account menu-icon"></i>
              <span class="menu-title">Profile</span>
            </a>
          </li> -->
          <li class="nav-item">
            <a class="nav-link" href="{{.base_url}}photo">
              <i class="mdi mdi-image menu-icon"></i>
              <span class="menu-title">Photos</span>
            </a>
          </li>
          <li class="nav-item active">
            <a class="nav-link" href="{{.base_url}}social_media">
              <i class="mdi mdi-view-headline menu-icon"></i>
              <span class="menu-title">Social Media</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{{.base_url}}coment">
              <i class="mdi mdi-comment-multiple-outline menu-icon"></i>
              <span class="menu-title">Coment</span>
            </a>
          </li>
        </ul>
      </nav>
      <!-- partial -->
      <div class="modal fade" id="staticBackdrop3" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdrop3Label" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="staticBackdrop3Label">Update Provile</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <form class="pt-3">
                <div class="form-group">
                  <input type="email" class="form-control form-control-lg" id="email" placeholder="Email">
                </div>
                <div class="form-group">
                  <input type="username" class="form-control form-control-lg" id="username" placeholder="Username">
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              <button type="button" class="btn btn-primary" onclick="updatePassword()">Save</button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="staticBackdropLabel">Transaction</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <form class="pt-3">
                <input type="hidden" class="form-control form-control-lg" id="id" >
                <div class="form-group">
                  <input type="text" class="form-control form-control-lg" id="message" placeholder="Message">
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              <button type="button" class="btn btn-primary" id="btn-submit" onclick="submitData()">Add Data</button>
            </div>
          </div>
        </div>
      </div>
      <div class="main-panel">
        <div class="content-wrapper">
          <div class="row">
            <div class="col-lg-12 grid-margin stretch-card">
                <div class="card">
                    <div class="card-body">
                      <h4 class="card-title">Comments</h4>
                      <button class="btn btn-sm btn-info" onclick="openModal('Submit')">Add Data</button>
                      <div class="table-responsive">
                        <table id="tblReportResultsDemographics" class="display" width="100%">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Title</th>
                                    <th>Photo</th>
                                    <th>Caption</th>
                                    <th>User</th>
                                    <th>Message</th>
                                    <th>Created At</th>
                                    <th>Updated At</th>
                                </tr>
                            </thead>
                            <tbody>

                            </tbody>
                          </table>
                      </div>
                    </div>
                  </div>
            </div>
          </div>
        </div>
        <!-- content-wrapper ends -->
        <!-- partial:{{.base_url}}assets/partials/_footer.html -->
        <footer class="footer">
        </footer>
        <!-- partial -->
      </div>
      <!-- main-panel ends -->
    </div>
    <!-- page-body-wrapper ends -->
  </div>
  <!-- container-scroller -->
  <!-- plugins:js -->
  <script src="{{.base_url}}assets/vendors/base/vendor.bundle.base.js"></script>
  <!-- endinject -->
  <!-- Plugin js for this page-->
  <!-- End plugin js for this page-->
  <!-- inject:js -->
  <script src="{{.base_url}}assets/js/off-canvas.js"></script>
  <script src="{{.base_url}}assets/js/hoverable-collapse.js"></script>
  <script src="{{.base_url}}assets/js/template.js"></script>
  <script src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

  <script>
    const urlGetList = "{{.baseURL}}comments"
    const urlGetDetail = "{{.baseURL}}setup/ftp/get-detail"
    const urlAdd = "{{.baseURL}}comments"
    const urlUpdate = "{{.baseURL}}comments"
    const urlDelete = "{{.baseURL}}comments"
    var base_64;
    $(document).ready(function(params) {
        getList()
        previewImage()
        $("#staticBackdrop").on("hidden.bs.modal", function(){
          location.reload()
        })
        // if (window.File && window.FileReader && window.FileList && window.Blob) {
        //     document.getElementById('photo_url').addEventListener('change', handleFileSelect, false);
        // } else {
        //     alert('The File APIs are not fully supported in this browser.');
        // }
        
    })
    function updatePassword(){
      var row_data ={
        "username":$("#username").val(),
        "email":$("#email").val()
      }
      if ($("#username").val() == "" || $("#email").val() == "") {
        swal({
          title:"Mohon untuk isi semua form",
          text: '',
          icon: "warning",
        })
      }else{

        $.ajax({
                url: "{{.base_url}}users/"+localStorage.getItem('token'),
                xhr: function() {
                  var myXhr = $.ajaxSettings.xhr();
                  return myXhr;
                },
                method: "PUT",
                data: JSON.stringify(row_data),
                cache: false,
                contentType: false,
                processData: false,
                contentType: 'application/json',
                success: function (resp) {
                  
                  swal({
                    title:"Congratulations!",
                    text: resp.responseJSON.message,
                    icon: "success",
                    timer:"3000",
                    buttons:false,
                    closeOnClickOutside: false
                  }).then(()=>{
                    localStorage.clear();
                    window.location.href = "{{.base_url}}"
                  })
                },
                beforeSend: function (xhr) {
                  xhr.setRequestHeader ("Authorization", "Bearer " + localStorage.getItem('token'));
                },
                complete: function(params) {
                  // $('#loading').addClass('d-none')
                },
                error: function (resp) {
                  swal({
                    title:"Upss!!!",
                    text: resp.responseJSON.message,
                    icon: "warning",
                  })
                }
              })
      }
    }
    function openModal(params) {
      $("#btn-submit").html(params)
      $("#staticBackdrop").modal('show')
    }
    function logout(params) {
        swal({
          title: "Apakah anda yakin ?",
          text: "Ingin logout",
          icon: "warning",
          buttons: true,
          dangerMode: true,
        }).then((willAdd) => {
          if(willAdd){
            localStorage.clear();
            swal({
                  title:"Congratulations!",
                  text: "Telah Logout",
                  icon: "success",
                  timer:"3000",
                  buttons:false,
                  closeOnClickOutside: false
                }).then(()=>{
                    window.location.href = "{{.base_url}}"
                })
          }
        })
    }
    function previewImage() {
      $("#photo_url").change(function() {
      var file = $("#photo_url").get(0).files[0];
    
        if(file){
          var reader = new FileReader();
    
          reader.onload = function(){
            $("#preview_png").attr("src", reader.result);
          }
    
          reader.readAsDataURL(file);
        }
      })
    }
    function handleFileSelect(evt) {
      var f = evt.target.files[0]; // FileList object
      var reader = new FileReader();
      // Closure to capture the file information.
      reader.onload = (function(theFile) {
          return function(e) {
              var binaryData = e.target.result;
              var base64String = window.btoa(binaryData);
              base_64 = base64String
          };
      })(f);
      // Read in the image file as a data URL.
      reader.readAsBinaryString(f);
    }
    function handlePurpose(params) {
        if (params == "Submit") {
            $(".ftp-setting").css('background-color','white')
            $("#btn-reset").removeClass('d-none')
            $("#btn-cancel").addClass('d-none')
            $("#btn-reset").trigger('click')
        }else{
            $(".ftp-setting").css('background-color','#bfbfbf')
            $("#btn-cancel").removeClass('d-none')
            $("#btn-reset").addClass('d-none')
        }
        $("#modal-submit").html(params)
    }
    function submitData() {
        var confirm = $('#btn-submit').html()
        var id = $('#id').val()
        var row_data = {
            "message":$("#message").val(),
        }
        if ($("#message").val() == '') {
          swal({
            title:"Mohon untuk isi semua form",
            text: '',
            icon: "warning",
          })
        }else{
          
            swal({
              title: "Apakah anda yakin ?",
              text: confirm=="Submit"?"ingin tambah data!":"ingin update data!",
              icon: "warning",
              buttons: true,
              dangerMode: true,
            }).then((willAdd) => {
              if(willAdd){
                $.ajax({
                  url: confirm=="Submit"?urlAdd:urlUpdate+"/"+id,
                  xhr: function() {
                    var myXhr = $.ajaxSettings.xhr();
                    return myXhr;
                  },
                  method: confirm=="Submit"?"POST":"PUT",
                  data: JSON.stringify(row_data),
                  cache: false,
                  contentType: false,
                  processData: false,
                  contentType: 'application/json',
                  success: function (resp) {
                    
                    swal({
                      title:"Congratulations!",
                      text: "Data telah tersimpan",
                      icon: "success",
                      timer:"3000",
                      buttons:false,
                      closeOnClickOutside: false
                    }).then(()=>{
                      location.reload()
                    })
                  },
                  beforeSend: function (xhr) {
                    xhr.setRequestHeader ("Authorization", "Bearer " + localStorage.getItem('token'));
                  },
                  complete: function(params) {
                    // $('#loading').addClass('d-none')
                  },
                  error: function (resp) {
                    swal({
                      title:"Upss!!!",
                      text: resp.responseJSON.message,
                      icon: "warning",
                    })
                  }
                })
              }
            })
        }
    }
    const toBase64 = file => new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result);
        reader.onerror = error => reject(error);
    });
    function getList(params) {
        $.ajax({
            url: urlGetList,
            type: "GET",
            beforeSend: function (xhr) {
                xhr.setRequestHeader ("Authorization", "Bearer " + localStorage.getItem('token'));
            },
            success: function (resp) {
                var oTblReport = $("#tblReportResultsDemographics")
                oTblReport.DataTable ({
                    "data" : resp,
                    "lengthChange":false,
                    "columns" : [
                        { 
                          "data" : "id",
                          "render": function (data, type, row) {
                            var btn = `
                              <div style="display: flex;justify-content: space-around;">
                                <div style="width: 25px;font-size: 8px;display: flex;justify-content: center;align-items: center;" data-asset_id="${data}" data-asset_name="" class="py-1 btn btn-sm btn-edit btn-primary edit_button mr-1" title="edit data" onclick="getContent('${row.message}','${row.id}')">
                                  <i class="fa fa-edit mr-0" style="color:white;"></i>
                                </div>
                                <div style="width: 25px;font-size: 8px;display: flex;justify-content: center;align-items: center;" data-asset_id="${data}" class="py-1 btn btn-sm btn-danger delete_button" title="delete data" onclick="deleteData('${data}')">
                                  <i class="fa fa-trash mr-0" style="color:white;"></i>
                                </div>
                              </div>
                            `
                            return btn;
                          },"sClass":"bg-tr"

                        },
                        { "data" : "Photo.title" },
                        { "data" : "Photo.photo_url",
                            "render": function (data, type, row) {
                            console.log(data);
                            return `<img style="width:90px;height:90px" src='${data?data:''}' onerror="this.onerror=null;this.src='{{.base_url}}assets/images/no_image.png';"/>`;
                            },"sClass":"sticky-tr"
                        },
                        { "data" : "Photo.caption" },
                        { "data" : "User.username" },
                        { "data" : "message" },
                        { "data" : "created_at" },
                        { "data" : "updated_at" },
                    ]
                });
            },
            error: function (resp) {
                alert(resp.responseJSON.Message)
            }
        })
    }
    function getContent(message,id) {
      // var json = JSON.parse(params);
      // console.log(json);
      $("#id").val(id)
      $("#message").val(message)
      openModal('Save');
    }
    function getBase64Image(img) {
      var canvas = document.createElement("canvas");
      canvas.width = img.width;
      canvas.height = img.height;
      var ctx = canvas.getContext("2d");
      ctx.drawImage(img, 0, 0);
      var dataURL = canvas.toDataURL("image/png");
      return dataURL;
    }
    function deleteData(params) {
      swal({
          title: "Apakah anda yakin ?",
          text: "Ingin menghapus data?",
          icon: "warning",
          buttons: true,
          dangerMode: true,
        }).then((willAdd) => {
          if(willAdd){
            $.ajax({
              url: urlDelete+"/"+params,
              method: "DELETE",
              beforeSend: function (xhr) {
                xhr.setRequestHeader ("Authorization", "Bearer " + localStorage.getItem('token'));
              },
              success: function (resp) {
                swal({
                  title:"Congratulations!",
                  text: "Data telah terhapus",
                  icon: "success",
                  timer:"3000",
                  buttons:false,
                  closeOnClickOutside: false
                }).then(()=>{
                  location.reload()
                })
              },
              error: function (resp) {
                  swal({
                    title:"Upss!!!",
                    text: resp.responseJSON.message,
                    icon: "warning",
                  })
                  // $('.animate-login').removeClass("lds-ripple")
              }
          })
          }
        })
    }
  </script>
</body>

</html>
